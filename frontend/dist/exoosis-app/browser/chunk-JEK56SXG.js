import{F as l,J as p,N as h,Yb as g,h as c,k as o,o as r,w as a}from"./chunk-JDCDSAQ7.js";var m=class u{constructor(e){this.api=e;let s=localStorage.getItem(this.currentUserKey);s&&this.userSubject.next(JSON.parse(s));let t=localStorage.getItem(this.tokenKey);t&&this.api.get("/auth/me").subscribe({next:n=>this.setSession(this.normalizeUser(n),t),error:()=>this.clearSession()})}userSubject=new c(null);user$=this.userSubject.asObservable();isLoggedIn$=this.user$.pipe(r(e=>!!e));currentUserKey="exoosis-user";tokenKey="exoosis_auth_token";login(e,s,t=!0){let n={identifier:e,password:s,rememberMe:t};return this.api.post("/auth/login",n).pipe(l(i=>this.setSession(this.normalizeUser(i.user),i.token)),r(i=>this.normalizeUser(i.user)),a(()=>o(null)))}signup(e){return this.api.post("/auth/signup",e).pipe(l(s=>this.setSession(this.normalizeUser(s.user),s.token)))}logout(){return this.api.post("/auth/logout").pipe(l(()=>this.clearSession()),r(()=>!0),a(()=>(this.clearSession(),o(!0))))}updateProfile(e){let s={fullName:e.fullName,email:e.email,phoneNumber:e.phoneNumber,profilePhotoUrl:e.profilePhotoUrl,street:e.address?.street,city:e.address?.city,state:e.address?.state,postalCode:e.address?.postalCode,country:e.address?.country,dateOfBirth:e.dateOfBirth,gender:e.gender};return this.api.put("/users/profile",s).pipe(r(t=>this.normalizeUser(t)),l(t=>this.setSession(t,localStorage.getItem(this.tokenKey)||"")))}changePassword(e,s){let n=this.userSubject.value?.role==="Admin"?"/admin/change-password":"/users/change-password";return this.api.put(n,{currentPassword:e,newPassword:s}).pipe(r(()=>({success:!0})),a(i=>o({success:!1,message:i})))}requestPasswordReset(e){return this.api.post("/auth/forgot-password",{email:e}).pipe(r(s=>({success:!0,token:s.token})),a(s=>o({success:!1,message:s})))}resetPassword(e,s){return this.api.post("/auth/reset-password",{token:e,newPassword:s}).pipe(r(()=>({success:!0})),a(t=>o({success:!1,message:t})))}getCurrentUser(){return this.userSubject.value}isAdmin(e){return(e??this.userSubject.value)?.role==="Admin"}isAuthenticated(){return!!this.userSubject.value}setSession(e,s){this.userSubject.next(e),localStorage.setItem(this.currentUserKey,JSON.stringify(e)),s&&localStorage.setItem(this.tokenKey,s)}clearSession(){this.userSubject.next(null),localStorage.removeItem(this.currentUserKey),localStorage.removeItem(this.tokenKey)}normalizeUser(e){let s={street:e.addressStreet,city:e.addressCity,state:e.addressState,postalCode:e.addressPostalCode,country:e.addressCountry};return{id:e.id,fullName:e.fullName,email:e.email,role:e.role,phoneNumber:e.phoneNumber,profilePhotoUrl:e.profilePhotoUrl,address:s,dateOfBirth:e.dateOfBirth,gender:e.gender,lastLoginAt:e.lastLoginAt,emailVerified:e.emailVerified}}static \u0275fac=function(s){return new(s||u)(h(g))};static \u0275prov=p({token:u,factory:u.\u0275fac,providedIn:"root"})};export{m as a};
